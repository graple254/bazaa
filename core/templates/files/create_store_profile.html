<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
      <title>Create Store Profile</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
      <div class="card mx-auto" style="max-width:600px;">
            <div class="card-header">
                  <h3>Create Your Store Profile</h3>
            </div>
            <div class="card-body">

                  {% if messages %}
                        {% for message in messages %}
                              <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                              </div>
                        {% endfor %}
                  {% endif %}

                  <form method="POST" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="mb-3">
                              <label class="form-label">Store Name</label>
                              <input type="text" class="form-control" name="name" required>
                        </div>

                        <div class="mb-3">
                              <label class="form-label">Subdomain</label>
                              <div class="input-group">
                                    <input id="subdomainInput" type="text" class="form-control" name="subdomain" required>
                                    <span class="input-group-text">.bazaa.digital</span>
                              </div>
                              <div class="form-text">Subdomain will be converted to lowercase and spaces removed.</div>
                        </div>

                        <div class="mb-3">
                              <label class="form-label">Description</label>
                              <textarea class="form-control" name="description" rows="3"></textarea>
                        </div>

                        <div class="mb-3">
                              <label class="form-label">WhatsApp Number</label>
                              <input type="text" class="form-control" name="whatsapp_number" placeholder="+2547xxxxxxx" required>
                        </div>

                        <div class="mb-3">
                              <label class="form-label">Logo</label>
                              <input id="logoInput" type="file" class="form-control" name="logo" accept="image/*" required>
                              <div class="mt-3">
                                    <img id="logoPreview" src="#" alt="Logo preview" class="img-fluid rounded" style="max-height:150px; display:none;">
                              </div>
                        </div>

                        <button type="submit" class="btn btn-success w-100">Create Store</button>
                  </form>
            </div>
      </div>
</div>

<script>
      // Subdomain: lowercase and remove spaces on input/paste/blur
      (function() {
            const sub = document.getElementById('subdomainInput');
            if (!sub) return;

            function sanitizeSubdomain(value) {
                  return (value || '').toLowerCase().replace(/\s+/g, '');
            }

            sub.addEventListener('input', (e) => {
                  const pos = sub.selectionStart;
                  sub.value = sanitizeSubdomain(sub.value);
                  // attempt to restore caret (simple best-effort)
                  sub.setSelectionRange(pos, pos);
            });

            sub.addEventListener('paste', (e) => {
                  e.preventDefault();
                  const text = (e.clipboardData || window.clipboardData).getData('text');
                  const sanitized = sanitizeSubdomain(text);
                  // insert at caret
                  const start = sub.selectionStart;
                  const end = sub.selectionEnd;
                  const newVal = sub.value.slice(0, start) + sanitized + sub.value.slice(end);
                  sub.value = sanitizeSubdomain(newVal);
                  const caret = start + sanitized.length;
                  sub.setSelectionRange(caret, caret);
            });

            sub.addEventListener('blur', () => {
                  sub.value = sanitizeSubdomain(sub.value);
            });
      })();

      // Logo preview
      (function() {
            const input = document.getElementById('logoInput');
            const preview = document.getElementById('logoPreview');
            if (!input || !preview) return;

            input.addEventListener('change', () => {
                  const file = input.files && input.files[0];
                  if (!file) {
                        preview.style.display = 'none';
                        preview.src = '#';
                        return;
                  }
                  if (!file.type.startsWith('image/')) {
                        preview.style.display = 'none';
                        preview.src = '#';
                        return;
                  }
                  const reader = new FileReader();
                  reader.onload = (e) => {
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                  };
                  reader.readAsDataURL(file);
            });
      })();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
